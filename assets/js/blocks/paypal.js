!function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(a,o,function(t){return e[t]}.bind(null,o));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=9)}([function(e,t){e.exports=window.wp.element},function(e,t){e.exports=window.wp.i18n},function(e,t){e.exports=window.wc.blocksCheckout},function(e,t){e.exports=window.wp.htmlEntities},function(e,t){e.exports=window.wc.wcBlocksRegistry},function(e,t){e.exports=window.wp.data},function(e,t){e.exports=window.wc.wcSettings},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));const a=(e,t,n)=>{const a=new FormData;return a.append("action",`wc_${t}_get_client_token`),a.append("nonce",n),fetch(e,{method:"POST",body:a}).then(e=>e.json()).then(e=>{if(e&&!e.success){const t=e.data&&e.data.message||"";throw new Error("Could not retrieve the client token via AJAX: "+t)}if(e&&e.success&&e.data)return e.data})}},,function(e,t,n){"use strict";n.r(t);var a=n(4),o=n(0),r=n(1),s=n(5),c=n(6);let i=null;const l=()=>{if(null!==i)return i;const e=Object(c.getSetting)("braintree_paypal_data",null);if(!e)throw new Error("Braintree Paypal initialization data is not available");return i={ajaxUrl:e.ajax_url||"",buttonStyles:e.button_styles||{},buttonWidth:e.button_width||null,clientTokenNonce:e.client_token_nonce||"",debug:e.debug||!1,description:e.description||"",forceBuyerCountry:e.force_buyer_country||"",integrationErrorMessage:e.integration_error_message||"Unknown error",isTestEnvironment:e.is_test_environment||!1,isPayPalPayLaterEnabled:e.is_paypal_pay_later_enabled||!1,isPayPalCardEnabled:e.is_paypal_card_enabled||!1,logoUrl:e.logo_url||"",messageLogoType:e.messaging_logo_type||"inline",messageLogoPosition:e.messaging_logo_position||"left",messageTextColor:e.messaging_text_color||"black",paymentErrorMessage:e.payment_error_message||"Unknown error",payPalDisabledFundingOptions:e.paypal_disabled_funding_options||[],payPalIntent:e.paypal_intent||"",paypalLocale:e.paypal_locale||"en_us",showSavedCards:e.show_saved_cards||!1,showSaveOption:e.show_save_option||!1,supports:e.supports||{},title:e.title||"",tokenizationForced:e.tokenization_forced||!1},i},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;l().debug&&(console.log("Braintree (PayPal): "+e),t&&console.log(t))},{buttonWidth:p,integrationErrorMessage:d}=l(),m=e=>{let{loadPayPalSDK:t,onError:n,buttonLoaded:a}=e;const r=Object(o.useRef)(!1),s="wc-braintree-paypal-button-container";Object(o.useEffect)(()=>{let e,o;return r.current=!0,async function(){try{const{dataCollectorInstance:n,paypalCheckoutInstance:c}=await t(s,r);r.current&&a(!0),e=c,o=n}catch(e){u("Integration Error: "+e.message,e),n(d)}}(),()=>{r.current=!1,a(!1),e&&e.teardown(),o&&o.teardown()}},[t,n,a]);const c=p?{width:p+"px"}:{};return Object(o.createElement)("div",{id:s,style:c})},{buttonWidth:y,messageLogoType:b,messageLogoPosition:g,messageTextColor:w,isPayPalPayLaterEnabled:f}=l(),_=e=>{let{amount:t}=e;const n="wc-braintree-paypal-pay-later-messaging-container";Object(o.useEffect)(()=>{if(!f)return;const e=document.getElementById(n);return e?paypal.Messages?void paypal.Messages({amount:t,style:{layout:"text",logo:{type:b,position:g},text:{color:w}}}).render("#"+n).catch(e=>{u("Could not render the PayPal Pay Later messeging: "+e.message,e)}):e.style.display="none":void 0},[t]);const a=y?{width:y+"px"}:{};return Object(o.createElement)("div",{id:n,style:a})};var E=n(3),h=n(2);const{description:O,isTestEnvironment:P}=l(),j=e=>{let{testAmount:t,setTestAmount:n}=e;return Object(o.createElement)(o.Fragment,null,!!P&&Object(o.createElement)("span",null,Object(r.__)("TEST MODE ENABLED","woocommerce-gateway-paypal-powered-by-braintree")),Object(o.createElement)("p",null,Object(E.decodeEntities)(O||"")),!!P&&Object(o.createElement)(o.Fragment,null,Object(o.createElement)(h.ValidatedTextInput,{id:"wc-braintree-paypal-test-amount",type:"text",label:Object(r.__)("Test Amount","woocommerce-gateway-paypal-powered-by-braintree"),value:t,onChange:n}),Object(o.createElement)("p",{style:{fontSize:"10px"},dangerouslySetInnerHTML:{__html:Object(r.sprintf)(/** translators: Placeholders: %1$s - <a> tag, %2$s - </a> tag */
Object(r.__)("Enter a %1$stest amount%2$s to trigger a specific error response, or leave blank to use the order total.","woocommerce-gateway-paypal-powered-by-braintree"),'<a href="https://developers.braintreepayments.com/reference/general/testing/php#test-amounts">',"</a>")}})))};var v=n(7);const{braintree:S}=window,{ajaxUrl:C,clientTokenNonce:k,isTestEnvironment:T,buttonStyles:x,payPalIntent:M,isPayPalPayLaterEnabled:A,isPayPalCardEnabled:R,payPalDisabledFundingOptions:L,tokenizationForced:I,paypalLocale:D,forceBuyerCountry:F}=l(),B=e=>{let{billing:{cartTotal:t,currency:n},onSubmit:a,shouldSavePayment:r,token:s=null}=e;const[c,i]=Object(o.useState)(""),[l,p]=Object(o.useState)(""),[d,m]=Object(o.useState)(""),y=n.code,b=(t.value/10**n.minorUnit).toFixed(2),g=Object(o.useMemo)(()=>!r&&!I,[r]),w=Object(o.useCallback)((e,t)=>{const n={env:T?"sandbox":"production",commit:!0,style:x,onApprove:(t,n)=>e.tokenizePayment(t).then((function(e){u("Payment tokenized.",e),i(e.nonce),a()})),onError(e){i(""),u("Payment Error: "+e.message,e)}},o=()=>e.createPayment({flow:g?"checkout":"vault",intent:g?M:"tokenize",amount:b,currency:y,locale:D});g?n.createOrder=o:n.createBillingAgreement=o;const r=document.getElementById(t);if(r&&(r.innerHTML=""),document.getElementById(t))return paypal.Buttons(n).render("#"+t)},[b,y,g,a]),f=Object(o.useMemo)(()=>{const[e,t]=[[],L];R||t.push("card"),A?e.push("paylater"):t.push("paylater");const n={components:A?"buttons,messages":"buttons",currency:y,intent:g?M:"tokenize",vault:!g,commit:!0};return e.length&&(n["enable-funding"]=e.join(",")),t.length&&(n["disable-funding"]=t.join(",")),F&&(n["buyer-country"]=F),n},[y,g]),_=Object(o.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={},a=await Object(v.a)(C,"braintree_paypal",k);u("Creating client");const o=await S.client.create({authorization:a});u("Client ready");try{const e=await S.dataCollector.create({client:o});e&&e.deviceData&&(t.current&&p(e.deviceData),n.dataCollectorInstance=e)}catch(e){u(e)}if(e){u("Creating integration");const t=await S.paypalCheckout.create({client:o});await t.loadPayPalSDK(f),await w(t,e),n.paypalCheckoutInstance=t,u("Integration ready")}return n}),[w,f]),E=Object(o.useCallback)(()=>{const e={wc_braintree_paypal_payment_nonce:c,wc_braintree_device_data:l};return g||(e["wc-braintree-paypal-tokenize-payment-method"]=!0),s&&(e["wc-braintree-paypal-payment-token"]=s,e.token=s,e.isSavedToken=!0),d&&(e["wc-braintree-paypal-test-amount"]=d),e},[l,g,c,d,s]);return{amount:b,testAmount:d,setTestAmount:m,loadPayPalSDK:_,getPaymentMethodData:E}},z=e=>{let{checkoutFormHandler:t,eventRegistration:n,emitResponse:a}=e;const{onPaymentProcessing:r,onCheckoutAfterProcessingWithError:s,onCheckoutAfterProcessingWithSuccess:c}=n,{getPaymentMethodData:i}=t;return((e,t,n)=>{Object(o.useEffect)(()=>e(()=>{const e=n();return e&&(e.token||e.wc_braintree_paypal_payment_nonce)?{type:t.responseTypes.SUCCESS,meta:{paymentMethodData:e}}:{type:t.responseTypes.ERROR,message:l().paymentErrorMessage,messageContext:t.noticeContexts.PAYMENTS}}),[t.responseTypes.SUCCESS,e,n,t.responseTypes.ERROR,t.noticeContexts.PAYMENTS])})(r,a,i),((e,t,n)=>{Object(o.useEffect)(()=>{const a=e=>{let t={type:n.responseTypes.SUCCESS};const{paymentStatus:a,paymentDetails:o}=e.processingResponse;return a===n.responseTypes.FAIL&&o.result===n.responseTypes.FAIL&&o.message&&(t={type:n.responseTypes.FAIL,message:o.message,messageContext:n.noticeContexts.PAYMENTS,retry:!0}),t},o=e(a),r=t(a);return()=>{o(),r()}},[e,t,n.noticeContexts.PAYMENTS,n.responseTypes.FAIL,n.responseTypes.SUCCESS])})(s,c,a),null},U=e=>{const[t,n]=Object(o.useState)(null),[a,r]=Object(o.useState)(!1),{eventRegistration:s,emitResponse:c,activePaymentMethod:i,components:{LoadingMask:l},billing:u,onSubmit:p,shouldSavePayment:d,token:y}=e,b=B({billing:u,onSubmit:p,shouldSavePayment:d,token:y}),{loadPayPalSDK:g,testAmount:w,setTestAmount:f,amount:E}=b;return Object(o.useEffect)(()=>{const e=document.querySelector("button.wc-block-components-checkout-place-order-button");if(e)return"braintree_paypal"===i&&e.setAttribute("disabled","disabled"),()=>{e.removeAttribute("disabled")}},[i]),Object(o.createElement)(o.Fragment,null,Object(o.createElement)(j,{testAmount:w,setTestAmount:f}),t&&Object(o.createElement)("div",{className:"woocommerce-error"},t),!t&&Object(o.createElement)(l,{isLoading:!a,showSpinner:!0},a&&Object(o.createElement)(_,{amount:E}),Object(o.createElement)(m,{loadPayPalSDK:g,onError:n,buttonLoaded:r})),Object(o.createElement)(z,{checkoutFormHandler:b,eventRegistration:s,emitResponse:c}))},{logoUrl:N,title:K,showSavedCards:H,showSaveOption:W,supports:Y}=l(),$=e=>{let{RenderedComponent:t,...n}=e;return Object(s.select)("core/editor")?null:Object(o.createElement)(t,n)};var q={name:"braintree_paypal",label:Object(o.createElement)(()=>Object(o.createElement)("img",{src:N,alt:K}),null),ariaLabel:Object(r.__)("Braintree PayPal Payment Method","woocommerce-gateway-paypal-powered-by-braintree"),canMakePayment:()=>!0,content:Object(o.createElement)($,{RenderedComponent:U}),edit:Object(o.createElement)($,{RenderedComponent:U}),savedTokenComponent:Object(o.createElement)($,{RenderedComponent:e=>{const{eventRegistration:t,emitResponse:n}=e,a=B(e),{loadPayPalSDK:r}=a,s=Object(o.useRef)(!1);return Object(o.useEffect)(()=>{let e;return s.current=!0,async function(){const{dataCollectorInstance:t}=await r("",s);e=t}(),()=>{s.current=!1,e&&e.teardown&&e.teardown()}},[r]),Object(o.createElement)(z,{checkoutFormHandler:a,eventRegistration:t,emitResponse:n})}}),supports:{showSavedCards:H||!1,showSaveOption:W||!1,features:Y||[]}};Object(a.registerPaymentMethod)(q)}]);